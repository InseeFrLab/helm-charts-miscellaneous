{
    "$schema": "http://json-schema.org/schema#",
    "type": "object",
    "properties": {
        "lomas-server": {
            "type": "object",
            "properties": {
                "dashboard": {
                    "title": "Dashboard Configuration",
                    "type": "object",
                    "properties": {
                        "affinity": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "create": {
                            "type": "boolean",
                            "default": true,
                            "hidden": false
                        },
                        "image": {
                            "description": "Docker Image",
                            "type": "object",
                            "properties": {
                                "pullPolicy": {
                                    "type": "string",
                                    "description": "option when pulling the docker image",
                                    "default": "IfNotPresent",
                                    "enum": [
                                        "IfNotPresent",
                                        "Always",
                                        "Never"
                                    ]
                                },
                                "repository": {
                                    "type": "string",
                                    "default": "dsccadminch/lomas_admin_dashboard",
                                    "enum": [
                                        "dsccadminch/lomas_admin_dashboard"
                                    ]
                                },
                                "tag": {
                                    "type": "string",
                                    "default": "latest",
                                    "enum": [
                                        "latest"
                                    ]
                                }
                            }
                        },
                        "imagePullSecrets": {
                            "type": "array",
                            "default": [],
                            "hidden": false
                        },
                        "ingress": {
                            "type": "object",
                            "properties": {
                                "annotations": {
                                    "type": "object",
                                    "hidden": false,
                                    "properties": {
                                        "nginx.ingress.kubernetes.io/proxy-read-timeout": {
                                            "type": "string",
                                            "default": "3600"
                                        }
                                    }
                                },
                                "className": {
                                    "type": "string",
                                    "default": "nginx",
                                    "hidden": false
                                },
                                "enabled": {
                                    "type": "boolean",
                                    "default": true,
                                    "hidden": false
                                },
                                "hostname": {
                                    "type": "string",
                                    "title":"Hostname",
                                    "x-onyxia": {
                                        "hidden": false,
                                        "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}-lomas-admin-dashboard-{{k8s.domain}}"
                                    }
                                }
                            }
                        },
                        "podAnnotations": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "podSecurityContext": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "replicaCount": {
                            "type": "integer",
                            "default": 1,
                            "hidden": false
                        },
                        "resources": {
                            "type": "object",
                            "description": "Your service will have at least the requested resources and never more than its limits. No limit for a resource and you can consume everything left on the host machine.",
                            "properties": {
                                "requests": {
                                    "description": "Guaranteed resources",
                                    "type": "object",
                                    "properties": {
                                        "cpu": {
                                            "description": "The amount of cpu guaranteed",
                                            "title": "CPU",
                                            "type": "string",
                                            "default": "100m",
                                            "render": "slider",
                                            "sliderMin": 50,
                                            "sliderMax": 40000,
                                            "sliderStep": 50,
                                            "sliderUnit": "m",
                                            "sliderExtremity": "down",
                                            "sliderExtremitySemantic": "guaranteed",
                                            "sliderRangeId": "cpu"
                                        },
                                        "memory": {
                                            "description": "The amount of memory guaranteed",
                                            "title": "memory",
                                            "type": "string",
                                            "default": "2Gi",
                                            "render": "slider",
                                            "sliderMin": 1,
                                            "sliderMax": 200,
                                            "sliderStep": 1,
                                            "sliderUnit": "Gi",
                                            "sliderExtremity": "down",
                                            "sliderExtremitySemantic": "guaranteed",
                                            "sliderRangeId": "memory"
                                        }
                                    }
                                },
                                "limits": {
                                    "description": "max resources",
                                    "type": "object",
                                    "properties": {
                                        "cpu": {
                                            "description": "The maximum amount of cpu",
                                            "title": "CPU",
                                            "type": "string",
                                            "default": "30000m",
                                            "render": "slider",
                                            "sliderMin": 50,
                                            "sliderMax": 40000,
                                            "sliderStep": 50,
                                            "sliderUnit": "m",
                                            "sliderExtremity": "up",
                                            "sliderExtremitySemantic": "Maximum",
                                            "sliderRangeId": "cpu",
                                            "x-onyxia": {
                                                "overwriteDefaultWith": "region.resources.cpuLimit",
                                                "useRegionSliderConfig": "cpu"
                                            }
                                        },
                                        "memory": {
                                            "description": "The maximum amount of memory",
                                            "title": "Memory",
                                            "type": "string",
                                            "default": "50Gi",
                                            "render": "slider",
                                            "sliderMin": 1,
                                            "sliderMax": 200,
                                            "sliderStep": 1,
                                            "sliderUnit": "Gi",
                                            "sliderExtremity": "up",
                                            "sliderExtremitySemantic": "Maximum",
                                            "sliderRangeId": "memory",
                                            "x-onyxia": {
                                                "overwriteDefaultWith": "region.resources.memoryLimit",
                                                "useRegionSliderConfig": "memory"
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "securityContext": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "serverConfig": {
                            "type": "object",
                            "properties": {
                                "address": {
                                    "type": "string",
                                    "default": "0.0.0.0",
                                    "hidden": false
                                },
                                "port": {
                                    "type": "string",
                                    "default": "8501",
                                    "hidden": false
                                }
                            }
                        },
                        "service": {
                            "description": "Service specific configuration",
                            "type": "object",
                            "properties": {
                                "port": {
                                    "description": "Port of the service",
                                    "type": "integer",
                                    "default": 80
                                },
                                "type": {
                                    "description": "type of the service",
                                    "type": "string",
                                    "default": "ClusterIP",
                                    "hidden": false
                                }
                            }
                        },
                        "tolerations": {
                            "type": "array",
                            "description": "Array of tolerations",
                            "default": [],
                            "x-onyxia": {
                                "hidden": false,
                                "overwriteDefaultWith": "region.tolerations"
                            }
                        },
                        "nodeSelector": {
                            "type": "object",
                            "description": "NodeSelector",
                            "default": {},
                            "x-onyxia": {
                                "hidden": false,
                                "overwriteDefaultWith": "region.nodeSelector"
                            }
                        },
                        "serviceAccount": {
                            "type": "object",
                            "hidden": false,
                            "properties": {
                                "annotations": {
                                    "type": "object"
                                },
                                "create": {
                                    "type": "boolean",
                                    "default": false
                                },
                                "name": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "fullnameOverride": {
                    "type": "string",
                    "x-onyxia": {
                        "hidden": false,
                        "overwriteDefaultWith":"{{project.id}}-{{k8s.randomSubdomain}}-lomas"
                    }
                },
                "mongodb": {
                    "type": "object",
                    "properties": {
                        "architecture": {
                            "type": "string",
                            "default": "standalone",
                            "hidden": false
                        },
                        "auth": {
                            "type": "object",
                            "description": "Authentification configuration",
                            "properties": {
                                "enabled": {
                                    "type": "boolean",
                                    "description": "add mongodb to server",
                                    "default": true
                                },
                                "rootUser": {
                                    "type": "string",
                                    "description": "root name",
                                    "default": "root"
                                },
                                "rootPassword": {
                                    "type": "string",
                                    "description": "root password",
                                    "default": "changeme",
                                    "x-onyxia": {
                                        "overwriteDefaultWith": "{{project.password}}"
                                    }
                                },
                                "databases": {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    },
                                    "description": "default databases",
                                    "default": ["defaultdb"]
                                }
                            }
                        },
                        "discoverable": {
                            "type": "object",
                            "hidden": false,
                            "properties": {
                                "allow": {
                                    "type": "boolean",
                                    "default": true
                                }
                            }
                        },
                        "fullnameOverride": {
                            "type": "string",
                            "x-onyxia": {
                                "hidden": false,
                                "overwriteDefaultWith":"{{project.id}}-{{k8s.randomSubdomain}}-lomas-mongodb"
                            }
                        },
                        "image": {
                            "type": "object",
                            "description": "image specific configuration",
                            "properties": {
                                "tag": {
                                    "type": "string",
                                    "description": "mongodb version",
                                    "default": "6.0.9-debian-11-r5"
                                }
                            }
                        },
                        "persistence": {
                            "type": "object",
                            "description": "configuration for persistence",
                            "properties": {
                                "resourcePolicy": {
                                    "description": "Set this to 'keep' to disable data pvc deletion when uninstalling the chart. Subsequent installs will use the same pvc, restoring the state of the server. Note: if the runtime_args.settings.develop_mode is set to True, the server state will be reset (default datasets and budgets).",
                                    "enum": [
                                        "",
                                        "keep"
                                    ],
                                    "type": "string",
                                    "default": ""
                                }
                            },
                            "enabled": {
                                "type": "boolean",
                                "description": "Create a persistent volume",
                                "default": true
                            },
                            "size": {
                                "type": "string",
                                "title": "Persistent volume size",
                                "description": "Size of the persistent volume",
                                "default": "10Gi",
                                "render": "slider",
                                "sliderMin": 1,
                                "sliderMax": 100,
                                "sliderStep": 1,
                                "sliderUnit": "Gi",
                                "hidden": {
                                    "value": false,
                                    "path": "mongodb/persistence/enabled"
                                }
                            }
                        },
                        "replicaCount": {
                            "type": "integer",
                            "default": 1,
                            "hidden": false
                        },
                        "resources": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "security": {
                            "description": "security specific configuration",
                            "type": "object",
                            "properties": {
                                "networkPolicy": {
                                    "type": "object",
                                    "description": "Define access policy to the service",
                                    "properties": {
                                        "enabled": {
                                            "type": "boolean",
                                            "title": "Enable network policy",
                                            "description": "Only pod from the same namespace will be allowed",
                                            "default": true,
                                            "x-onyxia": {
                                                "overwriteDefaultWith": "region.defaultNetworkPolicy"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "nameOverride": {
                    "type": "string",
                    "default": "",
                    "hidden": false
                },
                "server": {
                    "title": "Server Configuration",
                    "type": "object",
                    "properties": {
                        "affinity": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "image": {
                            "description": "Docker Image",
                            "type": "object",
                            "properties": {
                                "pullPolicy": {
                                    "type": "string",
                                    "description": "option when pulling the docker image",
                                    "default": "IfNotPresent",
                                    "enum": [
                                        "IfNotPresent",
                                        "Always",
                                        "Never"
                                    ]
                                },
                                "repository": {
                                    "type": "string",
                                    "default": "dsccadminch/lomas_server",
                                    "enum": [
                                        "dsccadminch/lomas_server"
                                    ]
                                },
                                "tag": {
                                    "type": "string",
                                    "default": "latest",
                                    "enum": [
                                        "latest"
                                    ]
                                }
                            }
                        },
                        "imagePullSecrets": {
                            "type": "array",
                            "default": [],
                            "hidden": false
                        },
                        "ingress": {
                            "type": "object",
                            "properties": {
                                "annotations": {
                                    "type": "object",
                                    "hidden": false,
                                    "properties": {
                                        "nginx.ingress.kubernetes.io/proxy-read-timeout": {
                                            "type": "string",
                                            "default": "3600"
                                        }
                                    }
                                },
                                "className": {
                                    "type": "string",
                                    "default": "nginx",
                                    "hidden": false
                                },
                                "enabled": {
                                    "type": "boolean",
                                    "default": true,
                                    "hidden": false
                                },
                                "hostname": {
                                    "type": "string",
                                    "title":"Hostname",
                                    "x-onyxia": {
                                        "hidden": false,
                                        "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}-lomas-server-{{k8s.domain}}"
                                    }
                                }
                            }
                        },
                        "podAnnotations": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "podSecurityContext": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "replicaCount": {
                            "type": "integer",
                            "default": 1,
                            "hidden": false
                        },
                        "resources": {
                            "description": "Your service will have at least the requested resources and never more than its limits. No limit for a resource and you can consume everything left on the host machine.",
                            "type": "object",
                            "properties": {
                                "requests": {
                                    "description": "Guaranteed resources",
                                    "type": "object",
                                    "properties": {
                                        "cpu": {
                                            "description": "The amount of cpu guaranteed",
                                            "title": "CPU",
                                            "type": "string",
                                            "default": "100m",
                                            "render": "slider",
                                            "sliderMin": 50,
                                            "sliderMax": 40000,
                                            "sliderStep": 50,
                                            "sliderUnit": "m",
                                            "sliderExtremity": "down",
                                            "sliderExtremitySemantic": "guaranteed",
                                            "sliderRangeId": "cpu"
                                        },
                                        "memory": {
                                            "description": "The amount of memory guaranteed",
                                            "title": "memory",
                                            "type": "string",
                                            "default": "2Gi",
                                            "render": "slider",
                                            "sliderMin": 1,
                                            "sliderMax": 200,
                                            "sliderStep": 1,
                                            "sliderUnit": "Gi",
                                            "sliderExtremity": "down",
                                            "sliderExtremitySemantic": "guaranteed",
                                            "sliderRangeId": "memory"
                                        }
                                    }
                                },
                                "limits": {
                                    "description": "max resources",
                                    "type": "object",
                                    "properties": {
                                        "cpu": {
                                            "description": "The maximum amount of cpu",
                                            "title": "CPU",
                                            "type": "string",
                                            "default": "30000m",
                                            "render": "slider",
                                            "sliderMin": 50,
                                            "sliderMax": 40000,
                                            "sliderStep": 50,
                                            "sliderUnit": "m",
                                            "sliderExtremity": "up",
                                            "sliderExtremitySemantic": "Maximum",
                                            "sliderRangeId": "cpu",
                                            "x-onyxia": {
                                                "overwriteDefaultWith": "region.resources.cpuLimit",
                                                "useRegionSliderConfig": "cpu"
                                            }
                                        },
                                        "memory": {
                                            "description": "The maximum amount of memory",
                                            "title": "Memory",
                                            "type": "string",
                                            "default": "50Gi",
                                            "render": "slider",
                                            "sliderMin": 1,
                                            "sliderMax": 200,
                                            "sliderStep": 1,
                                            "sliderUnit": "Gi",
                                            "sliderExtremity": "up",
                                            "sliderExtremitySemantic": "Maximum",
                                            "sliderRangeId": "memory",
                                            "x-onyxia": {
                                                "overwriteDefaultWith": "region.resources.memoryLimit",
                                                "useRegionSliderConfig": "memory"
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "runtime_args": {
                            "type": "object",
                            "properties": {
                                "settings": {
                                    "type": "object",
                                    "properties": {
                                        "dataset_store": {
                                            "type": "object",
                                            "description": "Dataset store configuration",
                                            "properties": {
                                                "ds_store_type": {
                                                    "description": "The type of dataset store.",
                                                    "enum": [
                                                        "basic",
                                                        "LRU_cache"
                                                    ],
                                                    "type": "string",
                                                    "default": "LRU_cache"
                                                },
                                                "max_memory_usage": {
                                                    "description": "Max memory usage of dataset store, in MiB. Only useful for LRU_cache type.",
                                                    "type": "integer",
                                                    "default": 512
                                                }
                                            }
                                        },
                                        "develop_mode": {
                                            "description": "When True, service database is reset to default user and dataset collections.",
                                            "type": "boolean",
                                            "default": true
                                        },
                                        "submit_limit": {
                                            "description": "Currently unused, maximum query rate",
                                            "type": "integer",
                                            "default": 300,
                                            "hidden": false
                                        },
                                        "server": {
                                            "type": "object",
                                            "description": "server configuration",
                                            "properties": {
                                                "time_attack": {
                                                    "type": "object",
                                                    "description": "methods to avoid time side channel attack",
                                                    "properties": {
                                                        "magnitude": {
                                                            "type": "integer",
                                                            "description": "Noise magnitude",
                                                            "default": 1
                                                        },
                                                        "method": {
                                                            "enum": [
                                                                "jitter",
                                                                "stall"
                                                            ],
                                                            "type": "string",
                                                            "description": "method for noise addition",
                                                            "default": "jitter"
                                                        }
                                                    }
                                                },
                                                "host_ip": {
                                                    "type": "string",
                                                    "description": "ip host of server",
                                                    "default": "0.0.0.0"
                                                },
                                                "host_port": {
                                                    "type": "string",
                                                    "description": "port of server",
                                                    "default": "80"
                                                },
                                                "log_level": {
                                                    "enum": [
                                                        "notset",
                                                        "debug",
                                                        "info",
                                                        "warning",
                                                        "error",
                                                        "critical"
                                                    ],
                                                    "type": "string",
                                                    "description": "level of verbosity",
                                                    "default": "info"
                                                },
                                                "reload": {
                                                    "type": "boolean",
                                                    "description": "automatic reload of server",
                                                    "default": false
                                                },
                                                "workers": {
                                                    "type": "integer",
                                                    "description": "number of workers",
                                                    "default": 1,
                                                    "hidden": false
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "securityContext": {
                            "type": "object",
                            "default": {},
                            "hidden": false
                        },
                        "service": {
                            "description": "Service specific configuration",
                            "type": "object",
                            "properties": {
                                "port": {
                                    "description": "Port of the service",
                                    "type": "integer",
                                    "default": 80
                                },
                                "type": {
                                    "description": "type of the service",
                                    "type": "string",
                                    "default": "ClusterIP",
                                    "hidden": false
                                }
                            }
                        },
                        "tolerations": {
                            "type": "array",
                            "description": "Array of tolerations",
                            "default": [],
                            "x-onyxia": {
                                "hidden": false,
                                "overwriteDefaultWith": "region.tolerations"
                            }
                        },
                        "nodeSelector": {
                            "type": "object",
                            "description": "NodeSelector",
                            "default": {},
                            "x-onyxia": {
                                "hidden": false,
                                "overwriteDefaultWith": "region.nodeSelector"
                            }
                        },
                        "serviceAccount": {
                            "type": "object",
                            "hidden": false,
                            "properties": {
                                "annotations": {
                                    "type": "object"
                                },
                                "create": {
                                    "type": "boolean",
                                    "default": false
                                },
                                "name": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
